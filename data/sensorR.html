<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>MGE</title>
    <script src="/highcharts.js"></script>
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" href="/css?family=Source+Sans+Pro:300,400,700">
    <link rel="stylesheet" href="/styles.min.css">
</head>

<body>
    <header class="header-blue">
        <nav class="navbar navbar-dark navbar-expand-md fixed-top navigation-clean-search" style="background: #ffffff;border-radius: 0px;border-bottom-right-radius: 20px;border-bottom-left-radius: 20px;">
            <div class="container-fluid"><a class="navbar-brand" href="/" style="margin-right: 16px;margin-left: 12px;border-color: rgb(0,0,0);color: rgb(0,0,0);font-size: 18px;">Medidor de Grandezas Elétricas</a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1" style="background: #184e8e;margin: -2px;border-radius: 10px;border-width: 0px;"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navcol-1">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link" href="/instructions" style="color: rgba(0,0,0,0.82);border-color: rgba(0,0,0,0.55);">Instruções</a></li>
                        <li class="nav-item dropdown"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="/sensor" style="color: rgba(0,0,0,0.82);border-color: rgba(0,0,0,0.55);">Leitura dos sensores</a>
                            <div class="dropdown-menu"><a class="dropdown-item" href="/sensor">Visão geral</a><a class="dropdown-item" href="/a">Sensores de corrente</a><a class="dropdown-item" href="/v">Sensor de tensão</a><a class="dropdown-item" href="/p">Potência/Consumo</a></div>
                        </li>
                        <li class="nav-item dropdown"><a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#" style="color: rgba(0,0,0,0.82);border-color: rgba(0,0,0,0.55);">Configurações</a>
                            <div class="dropdown-menu"><a class="dropdown-item" href="/config">Configurar Wi-Fi</a><a class="dropdown-item" href="/configAP">Configurar Wi-Fi AP</a><a class="dropdown-item" href="/param">Configurar parâmetros</a><a class="dropdown-item" href="/opMode">Modos de operação</a><a class="dropdown-item" href="/update">Atualização de firmware</a></div>
                        </li>
                    </ul>
                    <form class="d-flex me-auto navbar-form" target="_self">
                        <div class="d-flex align-items-center"><label class="form-label d-flex mb-0" for="search-field"></label></div>
                    </form><a class="btn btn-outline-danger" role="button" style="border-radius: 40px;font-size: 16px;font-weight: bold;border-width: 3px;" href="/reset">Reiniciar</a><span class="navbar-text"> </span>
                </div>
            </div>
        </nav>
        <div class="content">
            <p>&nbsp;</p>
            <p>&nbsp;</p>
            <p>&nbsp;</p>
            <section class="card" style="border-radius: 30px;padding-top: 20px;margin-top: 25px; margin-right: 30px; margin-left: 30px;">
              <p style="font-size: 30px; text-align: center;">Leitura do sensor ZMPT101B</p>
              <p style="text-align: center;">Tens&atilde;o =&nbsp;<span id="voltage">%VOLTAGE%</span>(V)</p>
              <div id="chart-voltage"class="container-fluid" style= "overflow: hidden; padding-right: 25px; max-width: 95%"></div>
            </section>

            <section class="card" style="border-radius: 30px;padding-top: 20px;margin-top: 25px; margin-right: 30px; margin-left: 30px;">
              <p style="font-size: 30px; text-align: center;">Leitura do sensor 1 -- SCT-013</p>
            	<p style="text-align: center;">Corrente =&nbsp;<span id="current">%CURRENT%</span>(A)</p>
            	<div id="chart-current" class="container-fluid" style= "overflow: hidden; padding-right: 25px; max-width: 95%"></div>
            </section>

            <section class="card" style="border-radius: 30px;padding-top: 20px;margin-top: 25px; margin-right: 30px; margin-left: 30px;">
              <p style="font-size: 30px; text-align: center;">Leitura do sensor 2 -- SCT-013</p>
              <p style="text-align: center;">Corrente =&nbsp;<span id="current1">%CURRENT1%</span>(A)</p>
              <div id="chart-current1" class="container-fluid" style= "overflow: hidden; padding-right: 25px; max-width: 95%"></div>
            </section>

            <section class="card" style="border-radius: 30px;padding-top: 20px;margin-top: 25px; margin-right: 30px; margin-left: 30px;">
              <p style="font-size: 30px; text-align: center;">C&aacute;lculo de Pot&ecirc;ncia</p>
            	<p style="text-align: center;">Pot&ecirc;ncia =&nbsp;<span id="power">%POWER%</span>(W)</p>
            	<div id="chart-power" class="container-fluid" style= "overflow: hidden; padding-right: 25px; max-width: 95%"></div>
            </section>

            <section class="card" style="border-radius: 30px;padding-top: 20px;margin-top: 25px; margin-right: 30px; margin-left: 30px;">
              <p style="font-size: 30px; text-align: center;">C&aacute;lculo de Consumo</p>
            	<p style="text-align: center;">Consumo =&nbsp;<span id="consumption">%CONS%</span>(KWh)</p>
            	<div id="chart-consumption" class="container-fluid" style= "overflow: hidden; padding-right: 25px; max-width: 95%"></div>
            </section>

        </div>
    </header>
    <footer class="footer-basic">
        <div class="social" style="height: 43px;">
            <p style="font-size: 18px;">Medidor de Grandezas Elétricas - V1</p>
        </div>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="/">Página inicial</a></li>
            <li class="list-inline-item"><a href="/instructions">Informações</a></li>
            <li class="list-inline-item"><a href="/opMode">Modos de operação</a></li>
            <li class="list-inline-item"><a href="/sensor">Leituras</a></li>
            <li class="list-inline-item"><a href="/dataOut">Exportar dados</a></li>
            <li class="list-inline-item"><a href="/resetOptions">Resets</a></li>
        </ul>
        <p class="copyright">Projeto de TCC realizado em 2021</p>
    </footer>
    <script>

        Highcharts.setOptions({
        time: {
            timezoneOffset: 3 * 60
        }
        });

        var chartT = new Highcharts.Chart({

          chart: {
            backgroundColor: '#ffffff',
            renderTo : 'chart-voltage'
          },
          title: { text: '' },
          series: [{
            showInLegend: false,
            data: []
          }],
          plotOptions: {
            line: { animation: false,
              dataLabels: { enabled: true }
            },
            series: { color: '#059e8a' }
          },
          xAxis: { type: 'datetime',
            dateTimeLabelFormats: { second: '%H:%M:%S' }
          },
          yAxis: {
            title: {
              text: 'Tens&atilde;o (V)'
            },
            endOnTick: false,
            maxPadding: 0.5
          },

          credits: { enabled: false }
        });
        setInterval(function ( ) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var x = (new Date()).getTime(),
                  y = parseFloat(this.responseText);
              //console.log(this.responseText);
              if (this.readyState == 4 && this.status == 200) {
                document.getElementById("voltage").innerHTML = this.responseText;
              }
              if(chartT.series[0].data.length > 40) {
                chartT.series[0].addPoint([x, y], true, true, true);
              } else {
                chartT.series[0].addPoint([x, y], true, false, true);
              }
            }
          };
          xhttp.open("GET", "/voltage", true);
          //xhttp.open("GET", "https://www.random.org/strings/?num=1&len=2&digits=on&unique=on&format=plain&rnd=new", true);
          xhttp.send();
        }, 1000 ) ;


        var chartH = new Highcharts.Chart({
          chart: {
            backgroundColor: '#ffffff',
            renderTo:'chart-current'
          },
          title: { text: '' },
          series: [{
            showInLegend: false,
            data: []
          }],
          plotOptions: {
            line: { animation: false,
              dataLabels: { enabled: true }
            }
          },
          xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { second: '%H:%M:%S' }
          },
          yAxis: {
            title: {
              text: 'Corrente (A)'
            },
            endOnTick: false,
            maxPadding: 0.5
          },
          credits: { enabled: false }
        });
        setInterval(function ( ) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var x = (new Date()).getTime(),
                  y = parseFloat(this.responseText);
              //console.log(this.responseText);

              if (this.readyState == 4 && this.status == 200) {
                document.getElementById("current").innerHTML = this.responseText;
              }
              if(chartH.series[0].data.length > 40) {
                chartH.series[0].addPoint([x, y], true, true, true);
              } else {
                chartH.series[0].addPoint([x, y], true, false, true);
              }
            }
          };
          xhttp.open("GET", "/current", true);
          // xhttp.open("GET", "https://www.random.org/strings/?num=1&len=2&digits=on&unique=on&format=plain&rnd=new", true);
          xhttp.send();
        }, 1000 ) ;

        var chartYJ = new Highcharts.Chart({
          chart: {
            backgroundColor: '#ffffff',
            renderTo:'chart-current1'
          },
          title: { text: '' },
          series: [{
            showInLegend: false,
            data: []
          }],
          plotOptions: {
            line: { animation: false,
              dataLabels: { enabled: true }
            }
          },
          xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { second: '%H:%M:%S' }
          },
          yAxis: {
            title: { text: 'Corrente (A)' }
          },
          credits: { enabled: false }
        });
        setInterval(function ( ) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var x = (new Date()).getTime(),
                  y = parseFloat(this.responseText);
              //console.log(this.responseText);

              if (this.readyState == 4 && this.status == 200) {
                document.getElementById("current1").innerHTML = this.responseText;
              }
              if(chartYJ.series[0].data.length > 40) {
                chartYJ.series[0].addPoint([x, y], true, true, true);
              } else {
                chartYJ.series[0].addPoint([x, y], true, false, true);
              }
            }
          };
          xhttp.open("GET", "/current1", true);
          // xhttp.open("GET", "https://www.random.org/strings/?num=1&len=2&digits=on&unique=on&format=plain&rnd=new", true);
          xhttp.send();
        }, 1000 ) ;


        var chartP = new Highcharts.Chart({
          chart: {
            backgroundColor: '#ffffff',
            renderTo:'chart-power'
          },
          title: { text: '' },
          series: [{
            showInLegend: false,
            data: []
          }],
          plotOptions: {
            line: { animation: false,
              dataLabels: { enabled: true }
            },
            series: { color: '#00fbff' }
          },
          xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { second: '%H:%M:%S' }
          },
          yAxis: {
            title: {
              text: 'Pot&ecirc;ncia (W)'
            },
            endOnTick: false,
            maxPadding: 0.5
          },
          credits: { enabled: false }
        });
        setInterval(function ( ) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var x = (new Date()).getTime(),
                  y = parseFloat(this.responseText);
              //console.log(this.responseText);
              if (this.readyState == 4 && this.status == 200) {
                document.getElementById("power").innerHTML = this.responseText;
              }
              if(chartP.series[0].data.length > 40) {
                chartP.series[0].addPoint([x, y], true, true, true);
              } else {
                chartP.series[0].addPoint([x, y], true, false, true);
              }
            }
          };
          xhttp.open("GET", "/power", true);
          // xhttp.open("GET", "https://www.random.org/strings/?num=1&len=2&digits=on&unique=on&format=plain&rnd=new", true);
          xhttp.send();
        }, 1000 ) ;


        var chartM = new Highcharts.Chart({
          chart: {
            backgroundColor: '#ffffff',
            renderTo:'chart-consumption'
          },
          title: { text: '' },
          series: [{
            showInLegend: false,
            data: []
          }],
          plotOptions: {
            line: { animation: false,
              dataLabels: { enabled: true }
            },
            series: { color: '#18009c' }
          },
          xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { second: '%H:%M:%S' }
          },
          yAxis: {
            title: {
              text: 'Consumo (KWh)'
            },
            endOnTick: false,
            maxPadding: 0.5
          },
          credits: { enabled: false }
        });
        setInterval(function ( ) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              var x = (new Date()).getTime(),
                  y = parseFloat(this.responseText);
              //console.log(this.responseText);
              if (this.readyState == 4 && this.status == 200) {
                document.getElementById("consumption").innerHTML = this.responseText;
              }
              if(chartM.series[0].data.length > 40) {
                chartM.series[0].addPoint([x, y], true, true, true);
              } else {
                chartM.series[0].addPoint([x, y], true, false, true);
              }
            }
          };

          xhttp.open("GET", "/consumption", true);
          // xhttp.open("GET", "https://www.random.org/strings/?num=1&len=2&digits=on&unique=on&format=plain&rnd=new", true);
          xhttp.send();
        }, 1000 ) ;

        </script>
    <script src="/bootstrap.min.js"></script>
</body>

</html>
